#!/bin/bash
echo "Linking modules"
if [ `uname -m |sed -e 's/i.86/32/'|sed -e 's/x86_//'` -eq 32 ]
then
    echo "LigBuilder only supports x86_64 system"
else
    \rm -rf bin/cavity 2>/dev/null
    \rm -rf bin/build 2>/dev/null
    echo "-> x86_64 System"
    version=`g++ -v 2>&1 |grep version`
    flag=`g++ -v 2>&1 |grep version |wc -l`
    if [ $flag -lt 1 ]
    then
        echo "-> No g++ compiler"
        echo "-> Using the static linking version"
        cp bin/build_static bin/build
        cp bin/cavity_static bin/cavity
    else
        echo "-> "$version
        g++ -o3 -Wl,-Bsymbolic-functions -fno-inline bin/cavity.a -Wall -o bin/cavity -lm
        if [ ! -e "bin/cavity" ]
        then
            cp bin/cavity_static bin/cavity
            echo "-> Cavity module linking failed, using the static linking version"
        else
            echo "-> Cavity module OK"
        fi
        g++ -o3 -Wl,-Bsymbolic-functions -fno-inline bin/build.a bin/libctemplate_nothreads.a -Wall -o bin/build -lm
        if [ ! -e "bin/build" ]
        then
            cp bin/build_static bin/build
            echo "-> Build module linking failed, using the static linking version"
        else
            echo "-> Build module OK"
        fi
    fi
fi
echo "Done" 
